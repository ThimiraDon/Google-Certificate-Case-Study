---
title: "Bellabeat Data Analysis Case Study"
author: "Thimira Mastiyage Don"
date: "`r Sys.Date()`"
output: 
    html_document:
      theme: cerulean
      toc: true
      toc_float: true
---

## 1. Overview & the business task
Bellabeat is a high-tech manufacturing company of health-focused products for women. This project is to analyze smart device usage data to gain insights into consumer behaviour with non-Bellabeat smart devices. Aim of this analysis is to apply these key findings and insights to a specific bellabeat product and construct recommendation to influence the Bellabeat marketing strategy.

These key findings will be presented to key stakeholders, Urška Sršen, Bellabeat’s co-founder and Chief Creative Officer, Sando Mur, Mathematician and Bellabeat’s co-founder and also key members of the Bellabeat executive team and finally to the Bellabeat marketing analytics team. These findings are expected to enhance Bellabeat marketing strategies, strengthen customer engagement and provide assistance to Bellabeat to be one of the leading companies in the tech-driven wellness industry. 

## 2. Data Description
For this Bellabeat data analysis, the primary data source is FitBit Fitness Tracker Data (Public Domain, dataset made available through Mobius) was generated by respondents to a distributed survey via Amazon Mechanical Turk between 03.12.2016 to 05.12.2016. This Kaggle data set contains personal fitness trackers from thirty fitbit users. Thirty eligible Fitbit users consented to the submission of personal tracker data, including minute-level output for physical activity, heart rate, and sleep monitoring. It includes information about daily activity, steps, and heart rate that can be used to explore users’ habits.

Through preliminary observation, This data set might have the following limitation to our analysis.

* Dataset was generated in 2016, which is not a recent dataset to make analysis.
Relying solely on historical insights has a limited value, especially in the tech-world which is a fast-changing business. This limits the ability to identify new opportunities and potential risks because, past trends which may not apply to current or future scenarios. So, this leads to inaccurate and incomplete analysis. 

* This dataset contains only thirty Fitbits users which is not enough to amplify the detection of statistical differences.

* Bellabeat only focuses on building high-tech smart devices to check women's health but Fitbit data does not contain demographic data such as gender and age. When finding key trends and insights from the Fitbit dataset, we cannot interpret insights related to women accurately and also we cannot give accurate recommendations to Bellabeat. 

## 3. Data Cleaning & Processing

```{r warning=FALSE,message=FALSE}
#Load Libraries
library(tidyverse)
library(dplyr)
library(janitor)
library(skimr)
library(lubridate)
library(ggplot2)
library(knitr)
library(highcharter)
library(kableExtra)
```

**3.1 Load dataset into R**
```{r message=FALSE}
dailyActivity <- read_csv("dailyActivity_merged.csv")
hourlyCalories <- read_csv("hourlyCalories_merged.csv")
dailySleep <- read_csv("sleepDay_merged.csv")
weightLog <- read_csv("weightLogInfo_merged.csv")
hourly_steps <- read_csv("hourlySteps_merged.csv")
```
**3.2 Overview and structure of the above datasets**

```{r echo= FALSE, results='asis'}
kbl(dailyActivity[1:5,],'html',caption = "Daily Activity Data") %>% 
  kable_styling(bootstrap_options = c("striped","hover","condensed")) %>% 
  scroll_box(width="100%")

kbl(hourlyCalories[1:5,],'html',caption = "Hourly burn calories Data") %>% 
  kable_styling(bootstrap_options = c("striped","hover","condensed"))

kbl(dailySleep[1:5,],caption = "Sleeping hours Data") %>% 
  kable_styling(bootstrap_options = c("striped","hover","condensed"))

kbl(weightLog[1:5,],caption = "Weight Data") %>% 
  kable_styling(bootstrap_options = c("striped","hover","condensed"))

```
```{r}
# strcuture of daily activity dataset
str(dailyActivity)
```
**3.3 Data Cleaning**

**3.3.1 Check missing values in all the datasets** 
```{r}
All_missing_values <- data.frame(dataset = c("dailyActivity","hourlyCalories","dailySleep","weightLog"),
                            missing_vlaues=c(sum(is.na(dailyActivity)),sum(is.na(hourlyCalories)),sum(is.na(dailySleep)),sum(is.na(weightLog))))

kable(All_missing_values,caption = "Count missing values in every table")
```
* weightLog dataset contains 65 missing values which are located in one column("Fat"). So, we cannot replace those values with using mean or median because all most every record in "Fat" column is empty. So in this case that column will be ignored for further analysis. 

```{r}
#selecting data without missing values from weightLog dataset.
weightLog <- select(weightLog,-"Fat")
kable(weightLog[1:5,], caption = "weightLog clean data")
#missing values in weightLog_clean
sum(is.na(weightLog))
```

**3.3.2 Check duplictaes in all datasets** 
```{r}
sum(duplicated(dailyActivity))
sum(duplicated(hourlyCalories))
sum(duplicated(dailySleep))
sum(duplicated(weightLog))
```
* There are three duplicates in "sleepDay" dataset. Those three will be removed for further analysis.

```{r}
dailySleep_clean <- distinct(dailySleep)
#checking duplictes again
sum(duplicated(dailySleep_clean))
```

**3.3.3 Convert date formats in every dataset**
```{r}
dailyActivity <- dailyActivity %>% 
  rename(Date = ActivityDate) %>% 
  mutate(Date = as.Date(Date, format = "%m/%d/%y"))

dailySleep_clean <- dailySleep_clean %>% 
  rename(Date = SleepDay) %>% 
  mutate(Date = as.Date(Date, format = "%m/%d/%y"))

weightLog <- weightLog %>% 
  select(-LogId) %>% 
  mutate(Date = as.Date(Date, format = "%m/%d/%y")) %>% 
  mutate(IsManualReport = as.factor(IsManualReport))


```
After converting date columns.
```{r}
kable(dailyActivity[1:5,1:5])
kable(dailySleep_clean[1:5,])
kable(weightLog[1:5,])
```

**3.4 Summary of each datasets**


```{r}
# Summarize selected columns in daily_activity dataset 
dailyActivity %>% select(TotalSteps,
         TotalDistance,
         Calories,
         SedentaryMinutes,
         LightlyActiveMinutes,
         FairlyActiveMinutes,
         VeryActiveMinutes) %>% skim_without_charts()

# Summarize selected columns in weightLog_clean dataset
weightLog %>% select(WeightKg,BMI) %>% skim_without_charts()

# Summarize selected columns in dailySleep_clean dataset
dailySleep_clean %>% select(TotalSleepRecords,
         TotalMinutesAsleep,
         TotalTimeInBed) %>% skim_without_charts()
```

**Key Findings**

**Activity Data (dailyActivity)**

* From this dataset we can clearly see average number of steps per day is 7638. Moreover, maximum number of steps per day is 36019 and median of 7406 steps per day.

* The Average Calories burning per day is 2304 and with a maximum of 4900. According to [WebMD](https://www.webmd.com/fitness-exercise/how-many-calories-do-i-burn-in-a-day),Calories burning process depends on age,sex,height,weight and the daily exercising routine. The average adult woman burns 1600-1950 calories and the average adult male burns 2000-2500 calories per day naturally. So, this indicates some users have calorie burning far above the average levels. 

* Sedentary minutes indicates diverse activities and lifestyle habits which has an average of 991 minutes per day with a maximum of 1440 minutes.

* Total distance vary from 0km to 28km per day with an average of 5.49km.

* Lightly active minutes and very active minutes have an average of 192.81 and 21.16 minutes per day respectively. This shows most users have lower active days. 

**Weight Data (weightLog_clean)**

* The average weight of an user is 72.04kg. Lowest and maximum weight of users are 52.6kg and 133.5kg respectively.

* The average BMI is 25.19, indicating that users, on average, fall within the overweight category based on [NSW Health](https://www.health.nsw.gov.au/heal/Pages/bmi.aspx#:~:text=Normal%20weight%3A%20BMI%20of%2018.5,BMI%20of%2030%20or%20higher).


**Sleep Data (dailySleep_clean)**

* Users have an average total minutes asleep of 419 minutes. But, that nearly hit the recommended sleeping hours for an adult according to [Mayo Clinic](https://www.mayoclinic.org/healthy-lifestyle/adult-health/expert-answers/how-many-hours-of-sleep-are-enough/faq-20057898) which is 7 to 9 hours per day.

Below data frame shows how users have participated in each dataset. There are only eight users in weightLog dataset while dailyActivity dataset has 33 users. So weightLog dataset is imbalance compare to dailyActivity.

```{r}
#checking number of user
user_count <- data.frame(dataset=c("dailyActivity","dailySleep_clean","weightLog_clean"),
                         number_of_users=c(n_distinct(dailyActivity$Id),n_distinct(dailySleep_clean$Id),n_distinct(weightLog$Id)))
kable(user_count)
```

**3.5 Merging the dataframes**

```{r}
df <- merge(dailyActivity,dailySleep_clean,by = c ("Id", "Date"))
final_df <- merge(df,weightLog,by = c ("Id", "Date"))
glimpse(final_df)
```


## 4. Summary of Visualization 

**4.1 Calculating correlation coefficients**

**1.Total steps vs Calories**
```{r, echo=FALSE}
custome_theme <- function(){
  theme(
    panel.border =element_rect(colour = "black",
                               fill = NA,
                               linetype = 1),
    panel.background = element_rect(fill = "white",
                                    color = "grey50")
  )
}
```


```{r warning=FALSE,message=FALSE}
#Totalsteps vs calories
ggplot(dailyActivity,aes(x=TotalSteps,y=Calories,color=Calories))+geom_point() + geom_smooth(method = "loess")+labs(title = "Total Steps vs Calories")+custome_theme() +theme(legend.position = c(.8,.3),plot.title = element_text(hjust = 0.5))
```

Calculating correlation coefficient between total steps and calories
```{r}
cor(dailyActivity$TotalSteps,dailyActivity$Calories)
```
The correlation coefficient between Total Steps and Calories is 0.59. It shows positive correlation. This correlation clearly shows, when number of steps increases, amount of calories burn tend to increase. So, users who take more steps might burn more calories. This correlation clearly visualize in the above scatter plot.

**2.Total distance vs Calories**

```{r,warning=FALSE,message=FALSE}
ggplot(dailyActivity,aes(x=TotalDistance,y=Calories,colour =Calories))+geom_point() + geom_smooth(method = "loess")+labs(title = "Total Distance vs Calories")+custome_theme() +theme(legend.position = c(.8,.3),plot.title = element_text(hjust = 0.5)) + scale_colour_gradient(low = "darkgreen", high = "darkolivegreen1")
```

Calculating correlation coefficient between total distance and calories

```{r}
cor(dailyActivity$TotalDistance,dailyActivity$Calories)
```

The correlation coefficient between Total Distance and Calories is 0.64 and shows strong positive correlation. It suggests that there is a significant relationship between the total distance and the calories. Users who cover more distance tend to burn more calories.

Both scatter plots supports the idea of higher physical activities, clearly helps to burn more calories. It emphasizes the importance of consistent physical activity in improving overall health and fitness.

**4.2 Distribution of daily activity level**

```{r}
activity <- dailyActivity %>% select(VeryActiveMinutes,
                         FairlyActiveMinutes,
                         LightlyActiveMinutes,
                         SedentaryMinutes)%>% 
                 summarise(across(everything(),list(sum))) %>% 
                 gather(active_level,minutes) %>% 
                 mutate(active_level=factor(active_level,labels=c("Moderate Activity","Light Activity",
                                                   "Sedentary","Heavy Activity")))
activity %>% hchart('pie',hcaes(x=active_level,y=minutes)) %>% 
             hc_title(text = "Distribution of daily activity level in minutes",
                      align = "center") %>% 
             hc_tooltip(pointFormat =" <b> Value:</b> {point.y} <br>
                          <b>Percentage</b> {point.percentage:,.2f}%")
```

Above graph shows mojority of the day people are sedentary.

**4.3 Hourly Average Calories Expenditure**

```{r}

hh <- hourlyCalories %>% rename(date_time=ActivityHour) %>% separate(date_time,into=c("date","time"),sep = "^\\S*\\K\\s+")



hh$date <- as.Date(hh$date, format = "%m/%d/%Y")
hh$time <- format(strptime(hh$time,"%I:%M:%S %p"), format ="%H:%M:%S" )
kable(hh[1:5,])


hh %>%
  group_by(time) %>%
  summarize(average_cal=mean(Calories)) %>%
  ggplot()+
  geom_col(mapping=aes(x=time,y=average_cal,fill=average_cal))+ 
  labs(title="Hourly Average Calories vs hour of day",x="hours",y="average calories per hour")+ 
  scale_fill_gradient(low="pink",high="purple")+
  theme(axis.text.x=element_text(angle=90),plot.title = element_text(hjust = 0.5))


```

The highest calories expenditure recorded in the evening between 5:00 p.m to 7:00 p.m. 

**4.4 Hourly Average Steps**
```{r}
hourly_steps<- hourly_steps %>% rename(date_time=ActivityHour) %>% separate(date_time,into=c("date","time"),sep = "^\\S*\\K\\s+")

hourly_steps$date <- as.Date(hourly_steps$date, format = "%m/%d/%Y")
hourly_steps$time <- format(strptime(hourly_steps$time,"%I:%M:%S %p"), format ="%H:%M:%S" )
kable(hourly_steps[1:5,])


hourly_steps %>%
  group_by(time) %>%
  summarize(average_steps=mean(StepTotal)) %>%
  ggplot()+
  geom_col(mapping=aes(x=time,y=average_steps,fill=average_steps))+ 
  labs(title="Hourly Average Steps vs hour of day",x="hours",y="average steps per hour")+ 
  scale_fill_gradient(low="limegreen",high="darkolivegreen")+
  theme(axis.text.x=element_text(angle=90),plot.title = element_text(hjust = 0.5))

```

As above graph shows, the users are the most active from 8:00 a.m. to 7:00 p.m. and number of steps are increased in the evening between 5:00 p.m. to 7:00 p.m. but peaking at 6:00 p.m.

**4.5 Sleep Distibution **

```{r}

sleep <- dailySleep %>% 
  select(TotalMinutesAsleep) %>% 
  drop_na() %>% 
  mutate(sleep_quality=ifelse(TotalMinutesAsleep<=420, "Less than 7h",
                      ifelse(TotalMinutesAsleep <= 540, "7h to 9h",
                             "More than 9h"))) %>% 
  mutate(sleep_quality = factor(sleep_quality, levels = c("Less than 7h","7h to 9h","More than 9h")))

sleep %>% ggplot(aes(x=TotalMinutesAsleep,fill = sleep_quality))+geom_histogram(position = "dodge",bins = 30)+custome_theme() + labs(title = "Sleep distribution") + theme(plot.title = element_text(hjust = 0.5))

```

In this graph clearly shows most of the user's get average of 5 to 8 hours of sleep.

## 5. Recomendations based on analysis

Recommendations for Bellabeat products-

* **Activity Goal Reminders** - Let users to set daily goals, weekly goals or monthly goals and remind them daily what task  has to be done to achieve their goals. Moreover, show their progress step by step, then users could get an idea of what they achieve in meantime. Then, additionally introduce a ranking system among users who's doing better at their tasks. 

* **Introduce Specific Workout Routine**  - Introducing High-intensity workout programs, weightlifting programs and sports to maintain their active life. This will improve their steps and time spending sedentary activities.

* **Introduce Meal Preparations** - New meal plans to avoid junk food and consume good quality food to stay healthy. 

* **Recommend Quality Sleep** - Send tips how to improve sleep time.
